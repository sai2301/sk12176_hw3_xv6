Implementation Overview
1. Kernel Modifications

Files changed:

proc.c, proc.h ‚Äì added priority field to struct proc; modified scheduler() to pick the runnable process with the highest priority (lowest numeric value).

sysproc.c ‚Äì implemented the system call sys_nice() that invokes setnice().

syscall.c, syscall.h, user.h ‚Äì registered the new syscall.

nice.c ‚Äì user program implementing the nice command.

Priority model:

Priority values range from 0 (highest) to 4 (lowest).

Default priority = 2.

Each call to nice adjusts a process‚Äôs priority either for the current process or a target PID.

2. Scheduler Policy

Modified the Round-Robin scheduler in proc.c to:

Iterate through all RUNNABLE processes.

Select the process with the smallest priority value.

Break ties with normal Round-Robin order.

Keep per-priority fairness using time slices.

3. System Call
int nice(int pid, int value);


pid = -1 or omitted ‚Üí modifies current process priority.

Returns: 0 on success, -1 on invalid PID or value.

Valid range for value: 0..4 (checked inside setnice()).

The syscall does not clamp invalid values‚Äîinvalid inputs are rejected.

üß™ User Programs
nice.c

Command-line interface to modify priority:

$ nice <pid> <value>
$ nice <value>


Examples:

$ nice 6 0
6 2
$ nice 8 4
8 2
$ nice 999 2
nice: failed for pid 999

test1.c ‚Äî Syscall Validation

Verifies self-priority change.

Checks invalid PID handling.

Ensures out-of-range values are correctly rejected.
Output:

OK: self pid=3 old=2 new=3
OK: invalid pid handled
OK: out-of-range handled

test2.c ‚Äî Priority Scheduling Behavior

Spawns 3 CPU-bound worker processes at priorities 0, 2, and 4.

Confirms that higher priority completes more iterations within a fixed time window.
Output:

[TEST2] duration=300 ticks
[TEST2] set priorities: pid 5->0, pid 6->2, pid 7->4
worker pid=5 done=5554
worker pid=6 done=5671
worker pid=7 done=5658
[TEST2] done. Expect roughly: work(pid=5) > work(pid=6) > work(pid=7)

test3.c ‚Äî Dynamic Renicing

Demonstrates dynamic reprioritization while processes are running.
Output:

[TEST3] start
renice: A old=4->0  B old=4->2
[TEST3] done


(minor ‚Äúexec fail‚Äù lines are harmless test helpers)

‚öôÔ∏è Build & Run Instructions
Build
make clean && make qemu-nox

Inside xv6
$ test1
$ test2
$ test3

To quit QEMU

Press Ctrl-A, then X.